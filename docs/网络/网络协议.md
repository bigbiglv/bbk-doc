# 网络协议

## `TCP`
- 主要用于在计算机网络中确保数据的可靠传输
- 是一个端到端的协议，通常运行在IP协议之上，形成我们常说的TCP/IP协议族

### 特点
1. 面向连接: 通信双方必须先建立连接才进行数据传输
2. 可靠性: 具有重传 确认应答等机制
   - 发送方发送数据后接收方接收成功后会应答
   - 在规定时间内接收方没有应答的话发送方会重新发送数据（重复大概3-5次）
3. 有序传输: 保证数据包按顺序发送到达接收方，数据切分成多个带序号小段接收的时候根据序号判断顺序
4. 拥塞控制: 监控网络的拥塞情况，根据网络的负载情况调整发送数据的速率，避免网络过载
   - 慢启动: 刚开始建立连接的时候会以较小的速率传输，数据包成功确认后会持续加大
   - 在速率大到一定程度时会减少增长防止网络堵塞
5. 流量控制: 根据接收方的处理能力调节数据传输速率，避免接收方的缓存溢出

### 建立连接（三次握手）
建立连接需要经历三次握手才能成功
1. `SYN`: 客户端发送一个 `SYN`（同步）包，告诉服务器它希望建立连接。此时，客户端进入 `SYN_SENT` 状态
2. `SYN-ACK`: 服务器收到客户端的 `SYN` 包后，确认客户端的请求，同时发送一个 `SYN-ACK` 包回客户端，表示同意建立连接。服务器进入 `SYN_RCVD` 状态
3. `ACK`: 客户端收到服务器的 `SYN-ACK` 包后，再发送一个 `ACK`（确认）包，确认收到服务器的响应。此时，客户端和服务器都进入 `ESTABLISHED`（已建立连接）状态，连接建立成功

### 连接关闭（四次挥手）
关闭连接需要经历四次挥手才能成功
1. `FIN`: 客户端向服务器发送一个 `FIN`（结束）包，表示它没有数据要发送了，但仍然可以接收数据
2. `FIN-ACK`: 服务器收到 `FIN` 包后，发送一个 `ACK` 包确认接收到客户端的 `FIN` 包，客户端进入 `FIN_WAIT_2` 状态
3. `FIN`: 服务器也准备好关闭连接时，向客户端发送一个 `FIN` 包，表示服务器没有数据要发送
4. `FIN-ACK`: 客户端收到服务器的 `FIN`包后，发送 `ACK` 包确认，连接关闭完成

### 数据包头部格式
1. 源端口和目标端口
2. 序列号
3. 确认号: 用于确认接收方已经接收到的数据的序列号
4. 标识位: `SYN`、`ACK`、`FIN` 等标志
5. 窗口大小: 流量控制
6. 校验和: 错误检测

## `UDP`
### 特点
1. 无连接: 不用建立连接, 不需要握手
2. 报文格式简单: 头部只有 8 个固定的字节(源端口, 目标端口, 长度, 校验和)
3. 不可靠: 丢包没有重传, 不保证数据包顺序到达
4. 速度快: 不需要建立连结, 没有流量控制, 不需要确认
5. 无拥塞控制, 无流量控制

### 适用场景
1. 实时音视频: 实时音视频需要保证速度, 即使丢包不重传由于不需要过时的数据实际也没有太大影响
2. 广播

### 注意事项
1. 添加序列号确保数据包顺序
2. 设置超时机制确保数据包不丢失
3. 容易受到网络攻击 `DTLS` 加密

## `QUIC`
基于 `UDP` 的传输协议, 在 `HTTP/3` 替代传统的 `TCP`

### 特点
1. 不需要三次握手
2. 集成 `TLS1.3` 加密所有数据, 安全性高
3. 多路复用优化头阻塞
4. 拥塞控制
5. 连接迁移: 客户端网络由 `4G`到`Wifi` 切换时不会断开
6. 频繁丢包的场景不如传统 `TCP`


## 区别
| 特性         | `UDP`      | `TCP`        | `QUIC`                   |
|------------|------------|--------------|--------------------------|
| **连接管理**   | 无连接        | 面向连接（三次握手）   | 无连接（0-RTT/1-RTT握手，基于UDP） |
| **可靠性**    | 不保证可靠性     | 提供可靠性传输      | 提供可靠性传输（基于UDP，内置重传）      |
| **数据传输顺序** | 不保证顺序      | 保证数据按顺序到达    | 支持多流传输，流之间独立，不会阻塞        |
| **传输速度**   | 快，低延迟      | 较慢，有延迟（确认机制） | 快，低延迟（支持0-RTT握手和快速恢复）    |
| **拥塞控制**   | 无拥塞控制      | 提供拥塞控制       | 提供灵活的拥塞控制（基于TCP算法）       |
| **适用场景**   | 实时应用、广播/多播 | 可靠传输（如文件、网页） | 实时应用、视频流、HTTP/3、低延迟通信    |




